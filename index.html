<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>S'S DARK - CLEAN START</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Rajdhani:wght@600&display=swap');
        
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            overflow: hidden; background: #000; font-family: 'Rajdhani', sans-serif; 
        }

        .game-frame { position: absolute; inset: 0; z-index: 1; }
        iframe { width: 100%; height: 100%; border: none; }
        
        @keyframes rgb-border {
            0% { border-color:#ff0000; box-shadow: 0 0 5px #ff0000; }
            50% { border-color:#00ff00; box-shadow: 0 0 5px #00ff00; }
            100% { border-color:#ff0000; box-shadow: 0 0 5px #ff0000; }
        }

        .floating-box {
            position: fixed; z-index: 99999;
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid #ff0000; border-radius: 12px;
            padding: 8px; text-align: center;
            animation: rgb-border 3s infinite linear;
            width: 140px;
            will-change: transform;
            box-shadow: 0 5px 15px rgba(0,0,0,0.8);
        }

        .handle {
            font-family: 'Orbitron'; font-size: 8px; color: #fff;
            background: rgba(255,255,255,0.1);
            margin-bottom: 8px; padding: 8px 0;
            border-radius: 6px; cursor: move;
            user-select: none; touch-action: none;
            letter-spacing: 1px;
        }

        #userBox { top: 80px; left: 15px; }
        #adminBox { top: 80px; right: 15px; width: 160px; border-color: #00ff88; }

        .result-box { background: rgba(255,255,255,0.05); border-radius: 8px; padding: 10px 0; margin: 5px 0; border: 1px solid #222; }
        #signalText { font-family: 'Orbitron'; font-size: 14px; font-weight: bold; display: block; color: #666; }
        #timerText { font-size: 20px; color: #ffeb3b; font-weight: bold; font-family: 'Orbitron'; display: block; }
        #periodText { font-size: 10px; color: #aaa; font-weight: bold; }

        input { width: 100%; background: #000; border: 1px solid #444; color: #fff; font-size: 11px; padding: 7px; margin-bottom: 5px; border-radius: 5px; text-align: center; outline: none; }
        
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-bottom: 5px; }
        button { border: none; border-radius: 5px; cursor: pointer; font-family: 'Orbitron'; font-weight: bold; transition: 0.1s; }
        button:active { transform: scale(0.9); }
        
        .btn-big { background: #00d2ff; color: #000; font-size: 10px; padding: 12px 0; }
        .btn-small { background: #ff007f; color: #fff; font-size: 10px; padding: 12px 0; }
        .btn-action { background: #fff; color: #000; font-size: 9px; padding: 8px 0; width: 100%; }
        .btn-reset { background: #ffeb3b; color: #000; font-size: 9px; padding: 8px 0; width: 100%; margin-top: 5px; }
        .hide-btn { background: rgba(255,0,0,0.2); color: #ff5555; font-size: 8px; padding: 5px 0; width: 100%; margin-top: 10px; border: 1px solid #f00; }

        .mini-trigger {
            position: fixed; width: 45px; height: 35px; background: #000; 
            display: none; align-items: center; justify-content: center; 
            z-index: 100000; font-size: 10px; font-weight: bold;
            box-shadow: 0 0 10px rgba(0,255,136,0.5); cursor: pointer;
        }
        #userTrigger { top: 40%; left: 0; color: #ffeb3b; border: 2px solid #ffeb3b; border-radius: 0 10px 10px 0; }
        #adminTrigger { top: 55%; right: 0; color: #00ff88; border: 2px solid #00ff88; border-radius: 10px 0 0 10px; }
    </style>
</head>
<body>

<div class="game-frame">
    <iframe src="https://hgnice.bet/#/register?invitationCode=678131139375"></iframe>
</div>

<!-- ইউজার প্যানেল -->
<div id="userBox" class="floating-box">
    <div class="handle" ontouchstart="startDrag(event, 'userBox')">S'S DARK LIVE</div>
    <div id="periodText">PERIOD: ---</div>
    <div class="result-box">
        <!-- একদম ক্লিন শুরু হবে -->
        <span id="signalText">WAITING</span>
        <span id="timerText">30s</span>
    </div>
    <button class="hide-btn" onclick="toggleView('userBox', 'userTrigger', false)">HIDE</button>
</div>

<!-- অ্যাডমিন প্যানেল -->
<div id="adminBox" class="floating-box">
    <div class="handle" ontouchstart="startDrag(event, 'adminBox')">ADMIN CONTROL</div>
    
    <div id="loginArea">
        <input type="password" id="passInput" placeholder="PASSWORD">
        <button class="btn-action" onclick="login()">LOGIN</button>
    </div>

    <div id="adminPanel" style="display: none;">
        <input type="number" id="periodInput" placeholder="PERIOD NO">
        <div class="btn-grid">
            <button class="btn-big" onclick="sendSignal('BIG 7,9', '#00d2ff')">BIG</button>
            <button class="btn-small" onclick="sendSignal('SMALL 0,2', '#ff007f')">SMALL</button>
        </div>
        <input type="text" id="customInput" placeholder="CUSTOM MSG">
        <button class="btn-action" onclick="sendCustom()">SEND CUSTOM</button>
        <button class="btn-reset" onclick="sendReset()">RESET (WAITING)</button>
        <button class="hide-btn" onclick="toggleView('adminBox', 'adminTrigger', false)">HIDE ADM</button>
    </div>
</div>

<div id="userTrigger" class="mini-trigger" onclick="toggleView('userBox', 'userTrigger', true)">LIVE</div>
<div id="adminTrigger" class="mini-trigger" onclick="toggleView('adminBox', 'adminTrigger', true)">ADM</div>

<script>
    // পেজ লোড হওয়ার সময় রেকর্ড করে রাখা
    const pageLoadTime = Date.now();

    const firebaseConfig = {
        apiKey: "AIzaSyAyrZ0fFcj5Y5HtlKzGJIsBtC9UeGbSDtI",
        authDomain: "signal-e5583.firebaseapp.com",
        databaseURL: "https://signal-e5583-default-rtdb.firebaseio.com",
        projectId: "signal-e5583",
        storageBucket: "signal-e5583.firebasestorage.app",
        messagingSenderId: "186804111926",
        appId: "1:186804111926:web:020f7476c0a9fab2cf2697"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    
    // --- 30S LIFETIME LOOP TIMER ---
    function update30sTimer() {
        const nowSeconds = Math.floor(Date.now() / 1000);
        const remaining = 30 - (nowSeconds % 30); 
        document.getElementById("timerText").innerText = remaining.toString().padStart(2, '0') + "s";
    }
    setInterval(update30sTimer, 1000);

    // --- FIREBASE LISTENING ---
    database.ref('liveControl').on('value', (snapshot) => {
        const data = snapshot.val();
        
        // লজিক: যদি ডাটাবেসের টাইটেলটি পেজ লোড করার আগের হয়, তবে তা দেখাবে না
        // অথবা যদি অ্যাডমিন নিজে থেকে রিসেট বাটন চাপে
        if(data) {
            if (data.signal === "WAITING") {
                showWaiting();
                document.getElementById("periodText").innerText = "PERIOD: " + data.period;
            } else if (data.timestamp > pageLoadTime) { 
                // শুধুমাত্র পেজ ওপেন করার পরের নতুন সিগন্যাল দেখাবে
                const signalElem = document.getElementById("signalText");
                signalElem.innerText = data.signal;
                signalElem.style.color = data.color;
                document.getElementById("periodText").innerText = "PERIOD: " + data.period;
            }
        }
    });

    function showWaiting() {
        const signalElem = document.getElementById("signalText");
        signalElem.innerText = "WAITING";
        signalElem.style.color = "#666";
    }

    // --- ADMIN ACTIONS ---
    function login() {
        if (document.getElementById("passInput").value === "support1234") {
            document.getElementById("loginArea").style.display = "none";
            document.getElementById("adminPanel").style.display = "block";
        } else { alert("Wrong Pass!"); }
    }

    function sendSignal(sig, col) {
        const p = document.getElementById("periodInput").value;
        if(!p) return alert("Enter Period!");
        database.ref('liveControl').set({ 
            signal: sig, 
            color: col, 
            period: p,
            timestamp: Date.now() // নতুন সিগন্যাল চিহ্নিত করতে টাইমস্ট্যাম্প
        });
    }

    function sendCustom() {
        const c = document.getElementById("customInput").value;
        const p = document.getElementById("periodInput").value;
        if(!c || !p) return alert("Fill all!");
        database.ref('liveControl').set({ 
            signal: c, 
            color: "#00ff88", 
            period: p,
            timestamp: Date.now() 
        });
    }

    function sendReset() {
        const p = document.getElementById("periodInput").value || "---";
        database.ref('liveControl').set({ 
            signal: "WAITING", 
            color: "#666", 
            period: p,
            timestamp: Date.now() 
        });
    }

    // --- ULTRA SMOOTH DRAG LOGIC (Translate3d) ---
    let activeBox = null;
    let currentX, currentY, initialX, initialY;
    let xOffsets = { userBox: 0, adminBox: 0 };
    let yOffsets = { userBox: 0, adminBox: 0 };

    function startDrag(e, id) {
        activeBox = document.getElementById(id);
        initialX = e.touches[0].clientX - xOffsets[id];
        initialY = e.touches[0].clientY - yOffsets[id];
        document.addEventListener("touchmove", drag, { passive: false });
        document.addEventListener("touchend", stopDrag);
    }

    function drag(e) {
        if (activeBox) {
            e.preventDefault();
            const id = activeBox.id;
            currentX = e.touches[0].clientX - initialX;
            currentY = e.touches[0].clientY - initialY;
            xOffsets[id] = currentX;
            yOffsets[id] = currentY;
            activeBox.style.transform = `translate3d(${currentX}px, ${currentY}px, 0)`;
        }
    }

    function stopDrag() {
        activeBox = null;
        document.removeEventListener("touchmove", drag);
    }

    function toggleView(boxId, triggerId, show) {
        document.getElementById(boxId).style.display = show ? "block" : "none";
        document.getElementById(triggerId).style.display = show ? "none" : "flex";
    }
</script>
</body>
</html>
